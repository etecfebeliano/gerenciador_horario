import{a as s,j as e,A as I,u as E,r as j,h as R,i as H,H as O,b as G}from"./index-3b258690.js";import"firebase/compat/app";import"firebase/compat/auth";import"firebase/compat/firestore";import"zod";import"exceljs";import"jspdf";const x=({tooltipText:r,children:t})=>s("div",{className:"relative group flex items-center",children:[t,s("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[r,e("svg",{className:"absolute text-gray-800 h-2 w-full left-0 top-full",x:"0px",y:"0px",viewBox:"0 0 255 255",children:e("polygon",{className:"fill-current",points:"0,0 127.5,127.5 255,0"})})]})]}),A=({title:r,value:t,icon:i,colorClass:n,tooltipText:c})=>s("div",{className:"bg-white p-4 rounded-lg shadow flex items-center",children:[e("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${n} mr-4 flex-shrink-0`,children:i}),s("div",{children:[e(x,{tooltipText:c,children:s("div",{className:"text-sm font-medium text-gray-500 flex items-center gap-1 cursor-help",children:[r,e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),e("div",{className:"text-2xl font-bold text-gray-800",children:t})]})]}),q=({completionPercentage:r,criticalAlerts:t,activeProfessors:i,totalTurmas:n})=>s("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[e(A,{title:"Preenchimento da Grade",value:`${r.toFixed(1)}%`,tooltipText:"Percentual de aulas alocadas na grade em relação ao total de aulas semanais necessárias para todas as disciplinas desta modalidade.",colorClass:"bg-blue-100 text-blue-600",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e(A,{title:"Alertas Críticos",value:String(t),tooltipText:"Número de conflitos de horário de professor (mesmo professor em duas turmas ao mesmo tempo). Estes são os alertas mais graves e devem ser resolvidos com prioridade.",colorClass:"bg-red-100 text-red-600",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e(A,{title:"Professores Ativos",value:String(i),tooltipText:"Número de professores únicos que possuem pelo menos uma aula alocada nesta grade de horários.",colorClass:"bg-green-100 text-green-600",icon:e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),e(A,{title:"Total de Turmas",value:String(n),tooltipText:"Número total de turmas cadastradas para esta modalidade (Regular ou Modular).",colorClass:"bg-purple-100 text-purple-600",icon:s("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[e("path",{d:"M12 14l9-5-9-5-9 5 9 5z"}),e("path",{d:"M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z"}),e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 14l9-5-9-5-9 5 9 5zm0 0l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14zm-4 6v-7.5l4-2.222 4 2.222V20"})]})})]}),_=({segments:r})=>{const t=r.reduce((o,d)=>o+d.value,0);if(t===0)return e("div",{className:"flex items-center justify-center h-full",children:s("svg",{className:"w-48 h-48 transform -rotate-90",viewBox:"0 0 120 120",children:[e("circle",{cx:"60",cy:"60",r:"50",fill:"none",stroke:"#e5e7eb",strokeWidth:"20"}),e("text",{x:"60",y:"60",textAnchor:"middle",dominantBaseline:"central",className:"transform rotate-90",fontSize:"14",fill:"#9ca3af",children:"Sem Alertas"})]})});const i=50,n=2*Math.PI*i;let c=0;return e("svg",{className:"w-48 h-48 transform -rotate-90",viewBox:"0 0 120 120",children:r.map((o,d)=>{const h=o.value/t*n,u=e("circle",{cx:"60",cy:"60",r:i,fill:"none",stroke:o.color,strokeWidth:"20",strokeDasharray:`${h} ${n}`,strokeDashoffset:-c},d);return c+=h,u})})},F=({data:r})=>{const t=Object.entries(r).map(([o,d])=>({type:o,value:d,color:I[o].bg.replace("bg-",""),name:I[o].name})),i={"pink-600":"#db2777","blue-500":"#3b82f6","red-600":"#dc2626","orange-400":"#fb923c","purple-500":"#a855f7","yellow-400":"#facc15"},n=t.map(o=>({value:o.value,color:i[o.color]||"#9ca3af"})),c=t.reduce((o,d)=>o+d.value,0);return s("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[e(x,{tooltipText:"Distribuição dos tipos de alertas encontrados na grade. Alertas são problemas como conflitos de horário, excesso de aulas, etc.",children:s("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-1 cursor-help",children:["Análise de Alertas",e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),s("div",{className:"flex-1 flex flex-col md:flex-row items-center gap-4 mt-4",children:[s("div",{className:"relative",children:[e(_,{segments:n}),s("div",{className:"absolute inset-0 flex flex-col items-center justify-center",children:[e("span",{className:"text-3xl font-bold text-gray-800",children:c}),e("span",{className:"text-sm text-gray-500",children:"Total"})]})]}),e("div",{className:"flex-1 space-y-2 text-sm w-full",children:t.sort((o,d)=>d.value-o.value).map(o=>s("div",{className:"flex items-center justify-between",children:[s("div",{className:"flex items-center",children:[e("span",{className:`w-3 h-3 rounded-full mr-2 ${I[o.type].bg}`}),e("span",{className:"text-gray-600",children:o.name})]}),e("span",{className:"font-semibold text-gray-800",children:o.value})]},o.type))})]})]})},V=({data:r})=>{const t=r.slice(0,10),i=Math.max(8,...t.map(n=>n.aulas));return s("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[e(x,{tooltipText:"Exibe os professores com a maior quantidade de aulas alocadas. As cores indicam a carga: Normal (azul), Alta (amarelo, >6 aulas) ou Sobrecarga (vermelho, >8 aulas).",children:s("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-1 cursor-help",children:["Carga Horária dos Professores (Top 10)",e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),e("div",{className:"flex-1 space-y-3 pr-4 mt-4",children:t.length>0?t.map((n,c)=>{const o=n.aulas/i*100;let d="bg-blue-500";return n.aulas>8?d="bg-red-500":n.aulas>6&&(d="bg-yellow-500"),s("div",{className:"flex items-center gap-4 text-sm",children:[e("div",{className:"w-1/3 truncate text-gray-600",title:n.nome,children:n.nome}),s("div",{className:"w-2/3 flex items-center",children:[e("div",{className:"w-full bg-gray-200 rounded-full h-5",children:e("div",{className:`h-5 rounded-full ${d} transition-all duration-500 ease-out`,style:{width:`${o}%`}})}),e("span",{className:"ml-3 font-semibold text-gray-800 w-8 text-right",children:n.aulas})]})]},c)}):e("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Nenhuma aula alocada na grade."})})]})},U=({data:r})=>s("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[e(x,{tooltipText:"Progresso de alocação de aulas para cada turma. Mostra quantas aulas já foram inseridas na grade em comparação com o total necessário para a turma.",children:s("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-1 cursor-help",children:["Status de Preenchimento por Turma",e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),e("div",{className:"flex-1 overflow-y-auto pr-2 space-y-3 mt-4",children:r.length>0?r.map(t=>{const i=t.total>0?t.alocadas/t.total*100:0;return s("div",{children:[s("div",{className:"flex justify-between items-center text-sm mb-1",children:[e("span",{className:"font-medium text-gray-700 truncate",title:t.nome,children:t.nome}),s("span",{className:"text-gray-500",children:[t.alocadas.toFixed(2)," / ",t.total.toFixed(2)]})]}),e("div",{className:"w-full bg-gray-200 rounded-full h-2.5",children:e("div",{className:"bg-green-600 h-2.5 rounded-full transition-all duration-500",style:{width:`${i}%`}})})]},t.id)}):e("div",{className:"flex items-center justify-center h-full text-gray-500",children:"Nenhuma turma para exibir."})})]}),Q=({data:r})=>{const{manha:t,tarde:i,noite:n}=r,o=t+i+n>0?Math.max(t,i,n):1,d=({label:h,value:u,colorClass:b})=>{const v=o>0?u/o*100:0;return s("div",{className:"flex flex-col items-center flex-1",children:[e("div",{className:"w-full h-40 flex items-end justify-center",children:e("div",{className:`w-10 rounded-t-md ${b} transition-all duration-500 ease-out`,style:{height:`${v}%`},title:`${h}: ${u} aulas`})}),e("div",{className:"text-xs font-semibold text-gray-600 mt-2",children:h}),e("div",{className:"text-sm font-bold text-gray-800",children:u})]})};return s("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[e(x,{tooltipText:"Distribuição do número de aulas alocadas em cada período. Ajuda a visualizar o equilíbrio da ocupação da grade entre manhã, tarde e noite.",children:s("h3",{className:"text-lg font-bold text-gray-800 flex items-center gap-1 cursor-help",children:["Ocupação por Período",e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})]})}),s("div",{className:"flex-1 flex items-end justify-around gap-4 mt-4",children:[e(d,{label:"Manhã",value:t,colorClass:"bg-yellow-400"}),e(d,{label:"Tarde",value:i,colorClass:"bg-blue-400"}),e(d,{label:"Noite",value:n,colorClass:"bg-indigo-500"})]})]})},J=({unassignedDisciplines:r,unassignedProfessors:t})=>s("div",{className:"bg-white p-4 rounded-lg shadow h-full flex flex-col",children:[e("h3",{className:"text-lg font-bold text-gray-800 mb-4",children:"Insights Rápidos"}),s("div",{className:"flex-1 space-y-4 overflow-y-auto",children:[s("div",{children:[e(x,{tooltipText:"Lista de disciplinas da grade selecionada (Regular ou Modular) que ainda não têm nenhum professor atribuído na tela de Gerenciamento.",children:s("h4",{className:"font-semibold text-gray-700 flex items-center cursor-help",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-orange-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Disciplinas Sem Atribuição (",r.length,")"]})}),r.length>0?e("ul",{className:"mt-2 text-sm text-gray-600 list-disc list-inside pl-7 max-h-24 overflow-y-auto",children:r.map(i=>e("li",{className:"truncate",title:i.nome,children:i.nome},i.id))}):e("p",{className:"mt-1 text-sm text-gray-500 pl-7",children:"Todas as disciplinas foram atribuídas."})]}),s("div",{children:[e(x,{tooltipText:"Lista de professores cadastrados no sistema que não foram atribuídos a NENHUMA disciplina, seja na grade Regular ou na Modular. Ajuda a identificar professores pendentes de configuração.",children:s("h4",{className:"font-semibold text-gray-700 flex items-center cursor-help",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2 text-blue-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Professores Sem Aulas (",t.length,")"]})}),t.length>0?e("ul",{className:"mt-2 text-sm text-gray-600 list-disc list-inside pl-7 max-h-24 overflow-y-auto",children:t.map(i=>e("li",{className:"truncate",title:i.nome,children:i.nome},i.id))}):e("p",{className:"mt-1 text-sm text-gray-500 pl-7",children:"Todos os professores foram atribuídos a alguma disciplina."})]})]})]}),se=()=>{const{state:r}=E(),[t,i]=j.useState("regular"),n=j.useMemo(()=>{const o=t==="modular",d=r.turmas.filter(m=>m.isModular===o),h=new Set(d.map(m=>m.id)),u=r.disciplinas.filter(m=>h.has(m.turmaId)),b=new Set(u.map(m=>m.id)),v=r.atribuicoes.filter(m=>b.has(m.disciplinaId)),w=r.grade.filter(m=>h.has(m.turmaId)),N=r.alertas.filter(m=>m.gradeSlotIds.some(L=>{const k=L.split("_")[0];return h.has(k)}));return{turmas:d,disciplinas:u,atribuicoes:v,grade:w,alertas:N,professores:r.professores}},[t,r]),c=j.useMemo(()=>{const{turmas:o,disciplinas:d,atribuicoes:h,grade:u,alertas:b}=n,v=d.reduce((a,l)=>a+l.aulasSemanais,0),w=new Map;u.forEach(a=>{const l=`${a.turmaId}_${a.dia}_${a.horario}`;if(!w.has(l)){const{finalDisciplinaId:f}=R(a,r);w.set(l,{disciplinaId:f,turmaId:a.turmaId})}});const N=new Map;w.forEach(a=>{const l=o.find(p=>p.id===a.turmaId),f=l!=null&&l.isModular?1.25:1,g=N.get(a.disciplinaId)||0;N.set(a.disciplinaId,g+f)});let m=0;N.forEach(a=>{m+=a});const L=v>0?m/v*100:0,k=b.reduce((a,l)=>(a[l.tipo]=(a[l.tipo]||0)+1,a),{}),P=k[H.ProfessorConflitoHorario]||0,T=new Set(u.map(a=>a.professorId)),M=new Map;u.forEach(a=>{var p;const l=r.professores.find(y=>y.id===a.professorId);if(!l)return;const g=((p=o.find(y=>y.id===a.turmaId))==null?void 0:p.isModular)??!1?1.25:1;M.has(l.id)||M.set(l.id,{nome:l.nome,aulas:0}),M.get(l.id).aulas+=g});const D=Array.from(M.values()).sort((a,l)=>l.aulas-a.aulas),S=o.map(a=>{const l=d.filter(p=>p.turmaId===a.id),f=l.reduce((p,y)=>p+y.aulasSemanais,0);let g=0;return l.forEach(p=>{g+=N.get(p.id)||0}),{id:a.id,nome:a.nome,alocadas:g,total:f}}).sort((a,l)=>(a.alocadas/a.total||0)-(l.alocadas/l.total||0)),C={manha:0,tarde:0,noite:0};w.forEach(a=>{const l=u.find(g=>g.turmaId===a.turmaId&&g.disciplinaId===a.disciplinaId);if(!l)return;const f=l.horario;O.includes(f)?C.manha++:G.includes(f)?C.tarde++:C.noite++});const z=new Set(h.map(a=>a.disciplinaId)),B=d.filter(a=>!z.has(a.id)),$=new Set(r.atribuicoes.flatMap(a=>a.professores)),W=r.professores.filter(a=>!$.has(a.id));return{completionPercentage:L,criticalAlertCount:P,activeProfessorCount:T.size,turmaCount:o.length,alertCounts:k,professorLoadData:D,turmaCompletionData:S,periodDistribution:C,unassignedDisciplines:B,unassignedProfessors:W}},[n,r]);return s("div",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 lg:p-6",children:[s("div",{className:"flex flex-col md:flex-row justify-between items-center mb-6",children:[e("h1",{className:"text-3xl font-bold text-gray-800",children:"Painel de Controle"}),e("div",{className:"mt-4 md:mt-0",children:s("div",{className:"flex items-center bg-gray-200 rounded-md p-1",children:[e("button",{onClick:()=>i("regular"),className:`px-4 py-2 text-sm font-medium rounded-md ${t==="regular"?"bg-indigo-600 text-white shadow":"text-gray-700 hover:bg-gray-300"}`,children:"Grade Regular"}),e("button",{onClick:()=>i("modular"),className:`px-4 py-2 text-sm font-medium rounded-md ${t==="modular"?"bg-indigo-600 text-white shadow":"text-gray-700 hover:bg-gray-300"}`,children:"Grade Modular"})]})})]}),s("div",{className:"grid grid-cols-12 gap-6",children:[e("div",{className:"col-span-12",children:e(q,{completionPercentage:c.completionPercentage,criticalAlerts:c.criticalAlertCount,activeProfessors:c.activeProfessorCount,totalTurmas:c.turmaCount})}),e("div",{className:"col-span-12 lg:col-span-4",children:e(F,{data:c.alertCounts})}),e("div",{className:"col-span-12 lg:col-span-8",children:e(V,{data:c.professorLoadData})}),e("div",{className:"col-span-12 lg:col-span-5",children:e(U,{data:c.turmaCompletionData})}),e("div",{className:"col-span-12 lg:col-span-3",children:e(Q,{data:c.periodDistribution})}),e("div",{className:"col-span-12 lg:col-span-4",children:e(J,{unassignedDisciplines:c.unassignedDisciplines,unassignedProfessors:c.unassignedProfessors})})]})]})};export{se as default};
