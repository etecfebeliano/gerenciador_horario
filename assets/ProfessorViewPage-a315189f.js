import{R as C,u as X,j as e,r as g,D as S,c as W,d as D,H as I,b as H,a as n,e as $,g as j,f as z}from"./index-5510b6df.js";import B from"jszip";import"firebase/compat/app";import"firebase/compat/auth";import"firebase/compat/firestore";import"zod";import"exceljs";import"jspdf";const F=({professorId:y})=>{const{state:a}=X(),{professores:b,grade:P,turmas:w,disciplinas:A}=a,f=b.find(r=>r.id===y);if(!f)return e("div",{className:"p-4 text-red-500",children:"Professor não encontrado."});const u=P.filter(r=>r.professorId===y),_=g.useMemo(()=>u.reduce((r,i)=>{const t=w.find(h=>h.id===i.turmaId),d=t!=null&&t.isModular?1.25:1;return r+d},0),[u,w]),v={};u.forEach(r=>{var d,h;v[r.dia]||(v[r.dia]={});const i=((d=w.find(c=>c.id===r.turmaId))==null?void 0:d.nome)||"N/A",t=((h=A.find(c=>c.id===r.disciplinaId))==null?void 0:h.nome)||"N/A";v[r.dia][r.horario]={turma:i,disciplina:t}});const L=g.useMemo(()=>S.reduce((r,i)=>{const t=u.filter(d=>d.dia===i).reduce((d,h)=>{const c=w.find(O=>O.id===h.turmaId),N=c!=null&&c.isModular?1.25:1;return d+N},0);return r[i]=t,r},{}),[u,w]),E=g.useMemo(()=>{const r=[...new Set([...W,...D])].sort();return[...I,...H,...r]},[]);return e("div",{className:"bg-white shadow-lg rounded-lg overflow-auto border border-gray-200",children:n("div",{className:"grid",style:{gridTemplateColumns:"80px repeat(5, minmax(150px, 1fr))"},children:[n("div",{className:"row-span-2 p-2 border-b-2 border-r border-gray-300 bg-gray-100 flex flex-col items-center justify-center text-center",children:[e("span",{className:"font-bold text-2xl",children:_}),e("span",{className:"text-xs text-gray-600",children:"Aulas"})]}),e("div",{className:"col-span-5 p-4 border-b-2 border-gray-300 bg-gray-200 text-center text-xl font-bold text-gray-800 flex items-center justify-center",children:f.nome}),e("div",{className:"col-start-2 col-span-5 grid grid-cols-5",children:S.map((r,i)=>e("div",{className:`p-2 border-b-2 bg-gray-100 text-center font-semibold capitalize ${i<S.length-1?"border-r":""} border-gray-300`,children:r.split("").join(" ")},r))}),E.map((r,i)=>{const t=I[I.length-1]===r,d=H[H.length-1]===r,h=t||d,c=i===E.length-1;return n(C.Fragment,{children:[n("div",{className:"contents",children:[e("div",{className:`p-2 border-r border-gray-300 bg-gray-50 text-xs text-center font-medium flex items-center justify-center ${c?"":"border-b"}`,children:r}),S.map((N,O)=>{var s;const o=(s=v[N])==null?void 0:s[r];return e("div",{className:`p-2 min-h-[50px] ${O<S.length-1?"border-r":""} ${c?"":"border-b"} border-gray-200`,children:o&&n("div",{className:"text-xs bg-indigo-100 p-1 rounded",children:[e("p",{className:"font-bold truncate",children:o.disciplina}),e("p",{className:"text-gray-600 truncate",children:o.turma})]})},`${N}-${r}`)})]}),h&&!c&&e("div",{className:"col-span-6 h-2 bg-gray-200 border-b border-gray-300"})]},r)}),e("div",{className:"p-2 border-r border-t border-gray-300 bg-gray-100 font-bold text-center flex items-center justify-center",children:"Carga Diária"}),S.map((r,i)=>e("div",{className:`p-2 bg-gray-100 text-center font-bold border-t ${i<S.length-1?"border-r":""} border-gray-200`,children:L[r]||0},`total-${r}`))]})})},U=C.memo(F),V=({progress:y,label:a,colorClass:b="bg-indigo-600"})=>n("div",{className:"w-full",children:[a&&n("div",{className:"flex justify-between mb-1 text-sm font-medium text-gray-700",children:[e("span",{children:a}),n("span",{children:[Math.round(y),"%"]})]}),e("div",{className:"w-full bg-gray-200 rounded-full h-2.5 overflow-hidden",children:e("div",{className:`h-2.5 rounded-full transition-all duration-300 ease-out ${b}`,style:{width:`${Math.max(0,Math.min(100,y))}%`}})})]}),re=()=>{var O;const{state:y}=X(),{dispatch:a}=$(),{professores:b,grade:P,turmas:w,disciplinas:A}=y,f=g.useMemo(()=>[...b].sort((o,s)=>o.nome.localeCompare(s.nome)),[b]),[u,_]=g.useState(""),[v,L]=g.useState(!1),[E,r]=g.useState({current:0,total:0}),i=g.useMemo(()=>u.trim()?f.filter(o=>o.nome.toLowerCase().includes(u.toLowerCase())):f,[f,u]),[t,d]=g.useState(((O=f[0])==null?void 0:O.id)||"");g.useEffect(()=>{var s;i.some(p=>p.id===t)||d(((s=i[0])==null?void 0:s.id)||"")},[u,i,t]),g.useEffect(()=>{!t&&f.length>0&&d(f[0].id)},[f,t]);const h=()=>{const o=b.find(s=>s.id===t);if(!o){a({type:"SHOW_TOAST",payload:"Professor não selecionado."});return}try{const{doc:s,error:p}=j(o,P,w,A);if(p||!s){a({type:"SHOW_TOAST",payload:p||"Erro ao gerar PDF."});return}const l=`horario_${o.nome.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.pdf`;s.save(l)}catch(s){console.error("Error generating PDF:",s),a({type:"SHOW_TOAST",payload:"Erro ao gerar o PDF."})}},c=()=>{if(!t){a({type:"SHOW_TOAST",payload:"Professor não selecionado."});return}a({type:"SHOW_TOAST",payload:"Gerando arquivo XLSX..."}),setTimeout(()=>{try{const{workbook:o,error:s}=z(y,t);if(s||!o){a({type:"SHOW_TOAST",payload:s||"Erro desconhecido ao gerar XLSX."});return}o.xlsx.writeBuffer().then(p=>{const m=new Blob([p],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),l=URL.createObjectURL(m),x=b.find(k=>k.id===t),R=x?x.nome.replace(/[^a-z0-9]/gi,"_").toLowerCase():"professor",T=document.createElement("a");T.setAttribute("href",l),T.setAttribute("download",`horario_${R}.xlsx`),document.body.appendChild(T),T.click(),document.body.removeChild(T),URL.revokeObjectURL(l),a({type:"SHOW_TOAST",payload:"Exportação para XLSX concluída!"})}).catch(p=>{console.error("Error writing XLSX buffer:",p),a({type:"SHOW_TOAST",payload:"Erro ao gerar o arquivo XLSX."})})}catch(o){console.error("Error generating XLSX file:",o),a({type:"SHOW_TOAST",payload:"Erro ao gerar o arquivo XLSX."})}},50)},N=async()=>{const o=[...new Set(P.map(m=>m.professorId))],s=f.filter(m=>o.includes(m.id));if(s.length===0){a({type:"SHOW_TOAST",payload:"Nenhum professor com aulas na grade para exportar."});return}const p=new B;L(!0),r({current:0,total:s.length}),a({type:"SHOW_TOAST",payload:`Iniciando exportação de ${s.length} horários...`});for(const[m,l]of s.entries()){r({current:m+1,total:s.length});try{const{doc:x,error:R}=j(l,P,w,A);if(x){const k=`horario_${l.nome.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.pdf`,M=x.output("blob");p.file(k,M)}}catch(x){console.error(`Error generating PDF for ${l.nome}:`,x)}await new Promise(x=>setTimeout(x,0))}a({type:"SHOW_TOAST",payload:"Gerando arquivo ZIP..."});try{const m=await p.generateAsync({type:"blob"}),l=document.createElement("a");l.href=URL.createObjectURL(m),l.download="horarios_professores.zip",document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(l.href),a({type:"SHOW_TOAST",payload:"Exportação para ZIP concluída!"})}catch(m){console.error("Error generating ZIP file:",m),a({type:"SHOW_TOAST",payload:"Erro ao gerar o arquivo ZIP."})}finally{L(!1)}};return n("div",{className:"flex-1 flex flex-col overflow-auto bg-gray-50 p-4",children:[n("header",{className:"mb-4",children:[e("h1",{className:"text-2xl font-bold text-gray-800",children:"Grade por Professor"}),n("div",{className:"mt-2 flex flex-col sm:flex-row sm:items-end sm:justify-between",children:[n("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 flex-grow mr-4",children:[n("div",{children:[e("label",{htmlFor:"professor-search",className:"block text-sm font-medium text-gray-700",children:"Buscar Professor"}),e("input",{type:"text",id:"professor-search",value:u,onChange:o=>_(o.target.value),placeholder:"Digite o nome...",className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md"})]}),n("div",{children:[e("label",{htmlFor:"professor-select",className:"block text-sm font-medium text-gray-700",children:"Selecione um Professor"}),e("select",{id:"professor-select",value:t,onChange:o=>d(o.target.value),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md",children:i.length>0?i.map(o=>e("option",{value:o.id,children:o.nome},o.id)):e("option",{value:"",disabled:!0,children:"Nenhum professor encontrado"})})]})]}),n("div",{className:"mt-4 sm:mt-0 flex flex-col sm:flex-row gap-2",children:[v?e("div",{className:"w-48",children:e(V,{progress:E.current/E.total*100,label:"Exportando..."})}):n("button",{onClick:N,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),"Exportar Todos (ZIP)"]}),n("button",{onClick:c,disabled:!t||v,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 disabled:bg-gray-400 disabled:cursor-not-allowed",children:[n("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"}),e("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e("polyline",{points:"10 9 9 9 8 9"})]}),"XLSX"]}),n("button",{onClick:h,disabled:!t||v,className:"w-full sm:w-auto inline-flex items-center justify-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 disabled:bg-gray-400 disabled:cursor-not-allowed",children:[e("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"PDF"]})]})]})]}),e("main",{className:"flex-1 overflow-auto",children:t?e(U,{professorId:t}):e("div",{className:"flex items-center justify-center h-full bg-white rounded-lg shadow",children:e("p",{className:"text-gray-500",children:b.length===0?"Nenhum professor cadastrado.":"Por favor, selecione um professor para visualizar a grade de horários."})})})]})};export{re as default};
